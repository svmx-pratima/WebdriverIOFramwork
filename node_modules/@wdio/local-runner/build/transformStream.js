"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _stream = require("stream");

var _constants = require("./constants");

class RunnerTransformStream extends _stream.Transform {
  constructor(cid, emitter) {
    super();
    this.cid = cid;
    this.emitter = emitter;
  }

  _transform(chunk, encoding, callback) {
    const logMsg = chunk.toString();

    if (_constants.DEBUGGER_MESSAGES.some(m => logMsg.startsWith(m))) {
      return callback();
    }

    this.push(`[${this.cid}] ${logMsg}`);
    callback();
  }

  _final() {
    /**
     * we don't want to do anything here otherwise we would end the
     * stream of the local runner that captures stdout/stderr or all
     * runners and therefor would loose all incoming messages after
     * the first runner finishes.
     */
  }

}

exports.default = RunnerTransformStream;